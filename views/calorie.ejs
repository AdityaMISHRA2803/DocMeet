<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <title>Diet Tracker | Health Management</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
    }
    
    /* Navigation gradient */
    .bg-nav-gradient {
      background: linear-gradient(19deg, rgb(28, 117, 250), rgb(34, 2, 159));
    }
    
    /* Custom styles for calorie tracker */
    .calorie-summary {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .total-calories {
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .total-calories span {
      color: #dc3545;
    }
  </style>
</head>

<body class="d-flex">
  <!-- Mobile Menu Toggle -->
  <button class="d-lg-none btn btn-primary position-fixed top-3 start-3 z-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Sidebar Navigation -->
  <div class="offcanvas-lg offcanvas-start bg-nav-gradient text-white vh-100" tabindex="-1" id="sidebar" style="width: 280px;">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Menu</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" data-bs-target="#sidebar"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column px-0">
      <ul class="nav flex-column">
        <li class="nav-item rounded-end py-2">
          <a class="nav-link text-white d-flex align-items-center" href="/dashboard">
            <i class="fas fa-home fs-5 mx-3"></i>
            <span class="fs-5">Dashboard</span>
          </a>
        </li>
        
        <li class="nav-item rounded-end py-2">
          <a class="nav-link text-white d-flex align-items-center" href="/appointment">
            <i class="fas fa-calendar-check fs-5 mx-3"></i>
            <span class="fs-5">Appointment</span>
          </a>
        </li>
        
        <li class="nav-item rounded-end py-2">
          <a class="nav-link text-white d-flex align-items-center" href="/disease">
            <i class="fas fa-search-plus fs-5 mx-3"></i>
            <span class="fs-5">Search Disease</span>
          </a>
        </li>
        
        <li class="nav-item active rounded-end py-2">
          <a class="nav-link text-white d-flex align-items-center" href="/calorie_tracker">
            <i class="fas fa-utensils fs-5 mx-3"></i>
            <span class="fs-5">Diet Tracker</span>
          </a>
        </li>
        
        <li class="nav-item rounded-end py-2">
          <a class="nav-link text-white d-flex align-items-center" href="/profile">
            <i class="fas fa-user-cog fs-5 mx-3"></i>
            <span class="fs-5">Edit Profile</span>
          </a>
        </li>
        
        <li class="nav-item rounded-end py-2">
          <a class="nav-link text-white d-flex align-items-center" href="/help">
            <i class="far fa-question-circle fs-5 mx-3"></i>
            <span class="fs-5">Help</span>
          </a>
        </li>
        
        <li class="nav-item rounded-end py-2">
          <a class="nav-link text-white d-flex align-items-center" href="/auth/logout">
            <i class="fas fa-sign-out-alt fs-5 mx-3"></i>
            <span class="fs-5">Sign Out</span>
          </a>
        </li>
      </ul>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-grow-1 ms-lg-5">
    <!-- Search Bar -->
    <div class="search-bar py-3 border-bottom">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col">
            <form class="d-flex position-relative">
              <button class="btn position-absolute start-0 top-50 translate-middle-y bg-transparent border-0" type="submit">
                <i class="fas fa-search text-secondary"></i>
              </button>
              <input class="form-control ps-5 border-0 shadow-none" type="search" placeholder="Global Search" aria-label="Search">
            </form>
          </div>
          <div class="col-auto">
            <i class="fas fa-laptop-medical fs-3 text-primary"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Diet Tracker Content -->
    <div class="container-fluid py-4">
      <div class="row">
        <!-- Main Content Column -->
        <div class="col-lg-8">
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body">
              <div class="d-flex align-items-center mb-4">
                <i class="fas fa-utensils me-2"></i>
                <h3 class="card-title mb-0">Diet Tracker</h3>
              </div>
              
              <!-- Add Meal Form -->
              <form action="/calorie_tracker" method="post" class="mb-4">
                <div class="row g-3">
                  <div class="col-md-5">
                    <label for="item-name" class="form-label">Meal/Food Item</label>
                    <input type="text" class="form-control" id="item-name" name="Item" placeholder="e.g. Chicken Breast" required>
                  </div>
                  <div class="col-md-3">
                    <label for="item-calories" class="form-label">Calories</label>
                    <input type="number" class="form-control" id="item-calories" name="calories" placeholder="Calories" required>
                  </div>
                  <div class="col-md-2">
                    <label for="item-times" class="form-label">Servings</label>
                    <input type="number" class="form-control" id="item-times" name="times" placeholder="1" value="1" min="1">
                  </div>
                  <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">
                      <i class="fas fa-plus me-1"></i> Add
                    </button>
                  </div>
                </div>
              </form>
              
              <!-- Calorie Summary -->
              <div class="calorie-summary mb-4">
                <h5 class="mb-3">Today's Nutrition Summary</h5>
                <div class="total-calories">
                  Total Calories: <span id="totalCalories">0</span> KCal
                </div>
              </div>
              
              <!-- Meal List -->
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead class="table-light">
                    <tr>
                      <th>Meal</th>
                      <th>Calories (KCal)</th>
                      <th>Servings</th>
                      <th>Total</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="mealTableBody">
                    <% if(meals.length > 0) { %>
                      <% meals.forEach(meal => { %>
                        <tr>
                          <td><%= meal.food %></td>
                          <td><%= meal.calories %></td>
                          <td><%= meal.times %></td>
                          <td><%= meal.calories * meal.times %></td>
                          <td>
                            <button class="btn btn-sm btn-outline-danger delete-btn" onclick="deleteMeal(this)">
                              <i class="fas fa-trash"></i>
                            </button>
                          </td>
                        </tr>
                      <% }); %>
                    <% } else { %>
                      <tr>
                        <td colspan="5" class="text-center py-4 text-muted">No meals logged today</td>
                      </tr>
                    <% } %>
                  </tbody>
                </table>
              </div>
              
              <div class="d-flex justify-content-end mt-3">
                <button class="btn btn-outline-danger" id="clearAllBtn">
                  <i class="fas fa-trash me-1"></i> Clear All
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Sidebar Column -->
        <div class="col-lg-4">
          <!-- Nutrition Tips -->
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <i class="fas fa-lightbulb me-2"></i>
                <h5 class="card-title mb-0">Nutrition Tips</h5>
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item border-0">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Drink at least 8 glasses of water daily
                </li>
                <li class="list-group-item border-0">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Include protein in every meal
                </li>
                <li class="list-group-item border-0">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Eat colorful fruits and vegetables
                </li>
                <li class="list-group-item border-0">
                  <i class="fas fa-check-circle text-success me-2"></i>
                  Limit processed foods and sugars
                </li>
              </ul>
            </div>
          </div>
          
          <!-- Recommended Daily Intake -->
          <div class="card border-0 shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <i class="fas fa-chart-line me-2"></i>
                <h5 class="card-title mb-0">Recommended Intake</h5>
              </div>
              <div class="progress mb-2" style="height: 20px;">
                <div class="progress-bar bg-success" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Carbs 45-65%</div>
              </div>
              <div class="progress mb-2" style="height: 20px;">
                <div class="progress-bar bg-info" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">Protein 10-35%</div>
              </div>
              <div class="progress" style="height: 20px;">
                <div class="progress-bar bg-warning" role="progressbar" style="width: 15%;" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100">Fats 20-35%</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Calculate and display total calories
      function updateTotalCalories() {
        let total = 0;
        document.querySelectorAll('#mealTableBody tr').forEach(row => {
          if (row.cells.length > 3) { // Ensure it's a meal row, not the "no meals" message
            const calories = parseInt(row.cells[1].textContent);
            const servings = parseInt(row.cells[2].textContent);
            total += calories * servings;
            row.cells[3].textContent = calories * servings;
          }
        });
        document.getElementById('totalCalories').textContent = total;
      }
      
      // Initial calculation
      updateTotalCalories();
      
      // Delete meal function
      window.deleteMeal = function(btn) {
        if (confirm('Are you sure you want to delete this meal?')) {
          const row = btn.closest('tr');
          row.remove();
          updateTotalCalories();
          
          // If no meals left, show the empty message
          if (document.querySelectorAll('#mealTableBody tr').length === 0) {
            const emptyRow = document.createElement('tr');
            emptyRow.innerHTML = '<td colspan="5" class="text-center py-4 text-muted">No meals logged today</td>';
            document.getElementById('mealTableBody').appendChild(emptyRow);
          }
        }
      };
      
      // Clear all meals
      document.getElementById('clearAllBtn').addEventListener('click', function() {
        if (confirm('Are you sure you want to clear all meals?')) {
          document.getElementById('mealTableBody').innerHTML = 
            '<tr><td colspan="5" class="text-center py-4 text-muted">No meals logged today</td></tr>';
          document.getElementById('totalCalories').textContent = '0';
        }
      });
    });
  </script>
</body>
</html>
