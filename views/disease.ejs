<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Disease Data</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito&display=swap" rel="stylesheet" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@600&amp;family=Poppins:wght@400;500;600&amp;display=swap" />
  <link rel="stylesheet" href="/disease.css" />

  <style>
    #spinner {
      display: none;
      text-align: center;
      margin: 20px auto;
      font-family: 'Poppins', sans-serif;
    }

    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #555;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <h1>
    <a href="/dashboard" class="back">‚¨ÖÔ∏èBACK</a>&nbsp;&nbsp;Get List of
    Diseases by entering the body part you want to search for.
  </h1>

  <div style="text-align: center; margin-top: 20px; color: #ff4d4d; font-family: 'Poppins', sans-serif;">
    <strong>Note:</strong> Real-time disease data powered by Doctor Chatbot API.
  </div>

  <section style="text-align: center; margin-top: 30px;">
    <label for="body_part">Body Part: </label>
    <input type="text" name="body_part" id="body_part" placeholder="e.g., brain, stomach, eye" required
      style="color: rgb(80, 78, 78)" />
    <input type="submit" value="Show Data" id="submit" onclick="data()" />
  </section>

  <div id="spinner">
    <div class="loader"></div>
    <p>Loading disease information...</p>
  </div>

  <ul id="myList">
    <li>
      <h1>DISEASES:</h1>
    </li>
  </ul>

  <script>
    function getSpecialization(bodyPart) {
      const map = {
        brain: "neurosurgery",
        heart: "cardiology",
        eye: "ophthalmology",
        stomach: "gastroenterology",
        skin: "dermatology",
        lung: "pulmonology",
        kidney: "nephrology",
        liver: "hepatology",
        teeth: "dentistry",
        bone: "orthopedics",
        nose: "ENT",
        throat: "ENT",
        blood: "hematology"
      };
      return map[bodyPart.toLowerCase()] || "general medicine";
    }

    function formatResponse(text) {
      const lines = text.split(/[\.\n]/).filter(line => line.trim().length > 0);
      return lines.map(line => `<li>ü©∫ ${line.trim()}</li>`).join('');
    }

    async function data() {
      const myList = document.getElementById("myList");
      const body_part = document.getElementById("body_part").value.trim().toLowerCase();
      const spinner = document.getElementById("spinner");

      myList.innerHTML = "<li><h1>DISEASES:</h1></li>";

      if (!body_part) {
        alert("Please enter a body part.");
        return;
      }

      const specialization = getSpecialization(body_part);
      const message = `What diseases are related to the ${body_part}?`;

      // Show loading spinner
      spinner.style.display = "block";

      try {
        const response = await fetch("https://ai-doctor-api-ai-medical-chatbot-healthcare-ai-assistant.p.rapidapi.com/chat?noqueue=1", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-rapidapi-host": "ai-doctor-api-ai-medical-chatbot-healthcare-ai-assistant.p.rapidapi.com",
            "x-rapidapi-key": "017118149bmshc01c294606b9939p1704f8jsn273ee77e52df"
          },
          body: JSON.stringify({
            message: message,
            specialization: specialization,
            language: "english"
          })
        });

        const data = await response.json();

        const responseText = formatResponse(data.response);
        myList.innerHTML += responseText;

      } catch (error) {
        console.error(error);
        const li = document.createElement("LI");
        li.innerText = "An error occurred while fetching data. Please try again.";
        myList.appendChild(li);
      } finally {
        spinner.style.display = "none";
      }
    }
  </script>
</body>

</html>
